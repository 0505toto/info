// 使用するGSAPプラグインを登録（ScrollToPluginを追加）
gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

// 1. ナビゲーションリンクをクリックしたら、該当セクションへスムーズにスクロール
const navLinks = gsap.utils.toArray("#scroll-navigation .navigator li a");

navLinks.forEach(link => {
    link.addEventListener("click", e => {
        e.preventDefault(); // デフォルトのアンカー動作をキャンセル
        const targetId = e.currentTarget.getAttribute("href");
        gsap.to(window, {
            duration: 1.2, // スクロールの時間
            scrollTo: {
                y: targetId,
                offsetY: 50 // 少し手前で止まるように調整
            },
            ease: "power2.inOut" // スクロールの緩急
        });
    });
});


// 2. スクロールに応じて、ナビゲーションとコンテンツをハイライト
const contentSections = gsap.utils.toArray(".portal-contents .item_base_simple_linklist_grn_tpl");

contentSections.forEach(section => {
    const targetLink = document.querySelector(`.navigator a[href="#${section.id}"]`);

    ScrollTrigger.create({
        trigger: section,
        start: "top center", // セクションの上端が画面中央に来たら
        end: "bottom center", // セクションの下端が画面中央を過ぎたら
        // ハイライトを切り替える
        onToggle: self => {
            if (self.isActive) {
                // アクティブになった時の処理
                navLinks.forEach(link => link.classList.remove("is-active"));
                contentSections.forEach(sec => sec.classList.remove("is-active-section"));

                targetLink.classList.add("is-active");
                section.classList.add("is-active-section");
            }
        },
    });
});


// 3. 元々のスクロールアニメーション（見た目のため）
// これは見た目の演出なので、不要ならこのブロックごと削除してもOK
const listItems = gsap.utils.toArray("#scroll-navigation .navigator li");
gsap.set("#scroll-navigation .navigator li:not(:first-of-type)", { opacity: 0.3, scale: 0.9 });
const timeline = gsap.timeline()
    .to("#scroll-navigation .navigator li:not(:first-of-type)", { opacity: 1, scale: 1, stagger: 0.5 })
    .to("#scroll-navigation .navigator li:not(:last-of-type)", { opacity: 0.3, scale: 0.9, stagger: 0.5 }, 0);

ScrollTrigger.create({
    trigger: "#scroll-navigation",
    start: "top top",
    end: "bottom bottom",
    scrub: true,
    animation: timeline
});
